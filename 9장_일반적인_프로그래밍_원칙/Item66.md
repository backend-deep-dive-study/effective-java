# 네이티브 메서드는 신중히 사용하라

### 네이티브 인터페이스

- 자바 프로그램이 네이티브 메서드를 호출하는 기술
- 네이티브 메서드: C, C++ 같은 네이티브 프로그래밍 언어로 작성한 메서드

### 네이티브 메서드 사용

- 레지스트리 같은 플랫폼 특화 기능 사용
- 네이티브 코드로 작성된 기존 라이브러리 사용
    - ex) 레거시 데이터를 사용하는 레거시 라이브러리
- 성능 개선을 목적으로 성능에 결정적인 영향을 주는 영역만 네이티브 언어로 작성

### 플랫폼 특화 기능 활용

- 자바가 발전하며 OS 같은 하부 플랫폼의 기능들을 점차 흡수 → 네이티브 메서드 사용 감소
- ex) 자바 9에서 process API를 추가해 OS 프로세스에 접근하는 길을 열어줌

### 네이티브 라이브러리

- 대체할 만한 자바 라이브러리가 없는 네이티브 라이브러리 사용 시 네이티브 메서드 사용
- ex) GMP, 암호 라이브러리(OpenSSL) 등

### 성능 개선 목적

- 성능 개선 목적으로 네이티브 메서드 사용은 권장X
- JVM의 발전으로 다른 플랫폼과 성능 차이가 크지 않음
- ex) BigInteger는 C로 작성한 고성능 라이브러리에 의지 → 순수 자바로 구현하며 튜닝한 결과 원래 네이티브 구현보다 빨라짐

### 네이티브 라이브러리 발전

- GNU 다중 정밀 연산 라이브러리(GMP)를 필두로 개선 작업 진행
    - 임의 정밀도의 정수, 유리수, 부동소수점 수에 대한 고속 연산을 지원하는 C 라이브러리
- 고성능의 다중 정밀 연산 필요 시 네이티브 메서드를 통한 GMP 사용 고려

### 네이티브 메서드 단점

- 네이티브 언어는 안전하지 않음
    - 버퍼 오버런, 배열 오버런, 와일드 포인터 같은 메모리 충돌 오류 위험
- 네이티브 메서드를 사용하는 애플리케이션도 메모리 훼손, 오류로부터 안전하지 않음
- 플랫폼을 많이 타서 이식성 낮음
- 디버깅 어려움
- 주의하지 않으면 속도가 오히려 느려질 위험
- 네이티브 메모리는 GC가 자동 회수/추적 불가능
- 자바와 네이티브 코드 경계를 넘나들 때 비용 추가
- 자바와 네이티브 코드 사이 접착 코드 작성 → 귀찮음 + 가독성 저하
    - JNI(Java Native Interface)로 연동해서 사용

### 정리

- 네이티브 메서드가 성능 개선하는 일 많지 않음
- 불가피하게 저수준 자원이나 네이티브 라이브러리 사용 시 사용
- 네이티브 코드는 최소한만 사용하고 철저히 테스트
- 네이티브 코드 안에 숨은 버그가 애플리케이션 전체를 훼손할 수 있음

#### 네이티브 코드 사용을 주의해라!

---

### 부록

#### 네이티브 라이브러리 연동 방식

- JNI (Java Native Interface): Java ↔ C/C++ 직접 호출 방식
- JNA (Java Native Access): JNI보다 단순하게 네이티브 함수 호출 가능 (퍼포먼스는 JNI보다 낮을 수 있음)
- BridJ, SWIG 등도 존재
