## 변경 가능성을 최소화하라
### 불변 클래스란
- 인스턴스의 내부 값을 수정할 수 없는 클래스
- 가변 클래스 보다 설계하고 구현하고 사용하기가 쉬우며, 오류가 생길 여지도 적고 안전함.
- ex) String, BigInteger, BigDecimal 등
- why?
  - 단순한 상태 관리(생성 시점부터 파괴될 때까지 동일한 상태를 유지하여 상태 변화를 추적할 필요가 없어 코드의 복잡성이 크게 줄음)
  - 스레드 안전성
  - 예측 가능성(메서드 호출 결과가 항상 동일하므로 코드의 동작을 예측하기 쉬움)
  - 방어적 복사 불필요
  - 부작용 방지(객체 상태가 변하지 않기 때문에 예상치 못한 부작용 발생X)
  - 등등
### 불변 클래스를 만드는 5가지 규칙
1. **객체의 상태를 변경하는 메서드(변경자)를 제공하지 않는다.**
2. **클래스를 확장할 수 없도록 한다.**
3. **모든 필드를 final로 선언한다.**
4. **모든 필드를 private으로 선언한다.**
5. **자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.**
### 불변 클래스의 장점
1. **불변 객체는 단순하다.**
   - 생성된 시점의 상태를 파괴될 때까지 그대로 유지시키기 때문!
2. **근본적으로 스레드 안전하여 따로 동기화할 필요 없다.**
   - 상태가 변하지 않기 때문에 여러 스레드가 동시에 접근해도 동기화 문제 발생 X
3. **안심하고 공유할 수 있다.**
   - 객체의 불변성에서 오는 근본적인 특성 -> 불변이기 때문에 여러 메서드나 스레드 간에 안전하게 전달됨.
   - 따라서 인스턴스를 최대한 재활용할 것.
4. **자유롭게 공유할 수 있음은 물론, 내부 데이터를 공유할 수 있다.**
   -  데이터 훼손이 불가능함.
   -  BigInteger의 negagte메서드는 부호만 반대인 새 BigInteger를 생성하는데, 새로 만든 인스턴스도 원본 인스턴스가 가리키는 내부 배열을 그대로 가리킴.
   -  즉, 내부 배열을 복사하지 않고 원본과 공유함 -> 메모리 사용량을 줄임.
5. **객체를 만들 때 다른 불변 객체들을 구성요소로 사용하면 이점이 많다.**
   - 불변 객체라면 구조가 복잡하더라도 불변식을 유지하기 훨씬 수월함.
   - ex) Map의 Key와 Set의 원소로 쓰기에 적합.
   - 캡슐화 강화 -> 외부에서 객체의 내부 상태를 변경할 가능성이 줄어듦.
   - 예측 가능성
6. **실패 원자성을 제공한다.**
   - 상태가 변하지 않으므로 불일치 상태가 없음.
### 불변 클래스의 단점
- **값이 다르면 독립된 객체로 새로 만들어야 하므로, 값의 가짓수가 많으면 비용이 큼.**
### 불변 클래스 설계 방법
1. **클래스를 final로 선언**
   - 자신을 상속하지 못하게 하는 가장 쉬운 방법
2. **모든 생성자를 private/package-private으로 만들고 public 정적 팩터리 제공**
   - 바깥에서 볼 수 없는 package-private 구현 클래스를 만들어 활용할 수 있으므로 유연
   - 정적 패터리 방식은 다수의 구현 클래스를 활용한 유연성을 제공
   - 뿐만 아니라, 다음 릴리스에서 객체 캐싱 기능을 추가해 성능을 올릴 수 있음. 
### 성능을 위한 규칙 완화
- "어떤 메서드도 객체의 상태 중 외부에 비치는 값을 변경할 수 없다" 정도로 규칙을 완화하여 계산 비용이 큰 값을 나중에 계산하여 캐시 가능
## 정리
- 클래스는 꼭 필요한 경우가 아니라면 불변이어야 함
- 불변으로 만들 수 없는 클래스라도 변경 가능성을 최소화할 것
- 다른 합당한 이유가 없다면 모든 필드는 private final이어야 함
- 생성자는 불변식 설정이 완료된, 초기화가 완벽히 끝난 상태의 객체를 생성해야 함

## 부록
### 함수형 프로그래밍 이란?
- 피연산자에 함수를 적용해 그 결과를 반환하지만, 피연산자 자체는 변경하지 않는 프로그래밍 패러다임
- ex) 책의 Complex클래스 예시처럼, 사칙연산 메서드들이 인스턴스 자신은 수정하지 않고 새로운 객체를 반환하는 방식.
### 실패 원자성(failure atomicity)이란?
-  ‘메서드에서 예외가 발생한 후에도 그 객체는 여전히 (메서드 호출 전과 똑같은) 유효한 상태여야 한다’는 성질
### 가변 동반 클래스란?
- 불변 클래스의 성능을 향상시키기 위해 함께 제공되는 가변 클래스
- ex) String의 가변 동반 클래스는 StringBuilder와 StringBuffer
### package-private란?
- 같은 패키지 내의 클래스에서만 접근할 수 있고, 패키지 외부에서는 접근할 수 없도록 함. 
(default)
```java
package user;

public class UserClass {

	private String name;

	String getName() {
		return name;
	}
}

package user;

public class OtherClass {

	private final UserClass userClass;

	public OtherClass() {

		this.userClass = new UserClass();
	}
	
	public String getName() {
		return this.userClass.getName();	
	}
}
```
### 객체 캐싱 기능이란?
- 자주 사용되는 객체 인스턴스를 메모리에 저장해두고 재사용하는 기법
- 메모리 사용량을 줄이고, 가비지 컬렉션 부담을 감소시키며, 객체 생성 비용을 절약해 성능을 향상시킴.
